<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Environment Configuration (loaded before everything) -->
    <script src="environment-config.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagiCard - Interactive Card Stacks</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Content will be dynamically inserted here -->
    </div>

    <!-- Loading indicator -->
    <div id="loading" class="loading-screen">
        <div class="loading-content">
            <h1>ü™Ñ MagiCard</h1>
            <p>Loading your magical card stacks...</p>
        </div>
    </div>

    <!-- Shared utilities (no modules) -->
    <script>
        // Placeholder shared functions for now - implement locally to avoid loading issues
        window.createSVGElement = function(type, attributes) {
            const element = document.createElementNS('http://www.w3.org/2000/svg', type);
            if (attributes) {
                Object.entries(attributes).forEach(([key, value]) => {
                    element.setAttribute(key, value);
                });
            }
            return element;
        };
        
        window.createTextComponent = function(config) {
            const text = createSVGElement('text', {
                x: config.x || 0,
                y: config.y || 0,
                fill: config.color || '#333',
                'font-family': config.fontFamily || 'Arial',
                'font-size': config.fontSize || 14
            });
            text.textContent = config.text || '';
            return text;
        };
        
        window.color = function(colorName) {
            const colors = {
                primary: '#9b59b6',
                secondary: '#27ae60',
                tertiary: '#e91e63',
                quaternary: '#f1c40f',
                cancel: '#e74c3c',
                inactive: '#95a5a6'
            };
            return colors[colorName] || '#333';
        };
    </script>
    
    <!-- Load castSpell system from fount server -->
    <script>
        // Load castSpell.js after environment is properly initialized
        async function loadCastSpellFromEnvironment() {
            try {
                // Wait for environment initialization from backend
                await window.initializeEnvironmentFromBackend();
                
                // Get the fount URL from the properly initialized environment
                const fountUrl = getServiceUrl('fount');
                console.log(`ü™Ñ Loading castSpell.js from environment-specific fount: ${fountUrl}`);
                
                const castSpellScript = document.createElement('script');
                castSpellScript.src = `${fountUrl.replace(/\/$/, '')}/castSpell.js`;
                castSpellScript.onload = function() {
                    console.log('‚úÖ castSpell.js loaded from fount server:', fountUrl);
                };
                castSpellScript.onerror = function() {
                    console.warn('‚ö†Ô∏è Failed to load castSpell.js from fount, using fallback');
                    // Initialize basic fallback castSpell function
                    window.castSpell = function(element) {
                        console.log('ü™Ñ Fallback spell cast on element:', element);
                        alert(`ü™Ñ Spell cast: ${element.getAttribute('spell')} (fallback mode - fount server unavailable)`);
                    };
                };
                document.head.appendChild(castSpellScript);
            } catch (error) {
                console.error('‚ùå Failed to load castSpell.js:', error);
                // Initialize fallback castSpell function
                window.castSpell = function(element) {
                    console.log('ü™Ñ Error fallback spell cast on element:', element);
                    alert(`ü™Ñ Spell cast: ${element.getAttribute('spell')} (error fallback - could not determine environment)`);
                };
            }
        }
        
        // Load castSpell after DOM and environment are ready
        document.addEventListener('DOMContentLoaded', loadCastSpellFromEnvironment);
    </script>
    
    <!-- JavaScript files (no modules) -->
    <script src="main.js"></script>
</body>
</html>