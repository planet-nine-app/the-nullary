<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://js.stripe.com/v3/"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes" />
    <meta name="theme-color" content="#000000" />
    <link rel="stylesheet" href="styles.css" />
    <title>Viewaris</title>
    <!-- Load spell systems before modules -->
    <script src="environment-config.js"></script>
    <script>
        async function loadSpellSystems() {
            try {
                // Wait for environment to be ready
                while (typeof getServiceUrl === 'undefined') {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                const fountUrl = getServiceUrl('fount');
                const covenantUrl = getServiceUrl('covenant');
                
                // Load castSpell.js from fount
                const castSpellScript = document.createElement('script');
                castSpellScript.src = `${fountUrl.replace(/\/$/, '')}/castSpell.js`;
                castSpellScript.onload = () => console.log('‚úÖ castSpell.js loaded from fount');
                castSpellScript.onerror = () => {
                    console.warn('‚ö†Ô∏è Failed to load castSpell.js, using fallback');
                    window.castSpell = (el) => alert(`ü™Ñ Spell: ${el.getAttribute('spell')} (fallback)`);
                };
                document.head.appendChild(castSpellScript);
                
                // Load covenant signing from covenant service
                const covenantScript = document.createElement('script');
                covenantScript.src = `${covenantUrl.replace(/\/$/, '')}/signCovenant.js`;
                covenantScript.onload = () => console.log('‚úÖ signCovenant.js loaded from covenant');
                covenantScript.onerror = () => console.warn('‚ö†Ô∏è Failed to load signCovenant.js');
                document.head.appendChild(covenantScript);
                
            } catch (error) {
                console.error('‚ùå Failed to load spell systems:', error);
            }
        }
        
        document.addEventListener('DOMContentLoaded', loadSpellSystems);
    </script>
    
    <script type="module" src="main.js" defer></script>
    <script type="module" src="stripe.js" defer></script>
  </head>

  <body>
    <div id="payment-div">
      <form id="payment-form" class="payment-form" style="display: none;">
	  <div id="payment-element">
	      <!-- Stripe Elements will be inserted here -->
	  </div>
	  <button id="submit-button">Pay now</button>
	  <div id="error-message" class="error-message" style="display: none;"></div>
	  <div id="loading" class="loading">Processing payment...</div>
      </form>
    </div>
    <main id="m">
      <div id="app" style="position: fixed; width: 100vw; height: 100vh; display: flex;">
      <div id="main"></div>
       <svg id="full-screen-svg" class="container" width="100%" height="100%">
          <foreignObject id="fo" x="25%" y="0" width="50%" height="100%" style="z-index: -1;">
            <div id="main2">
            </div>
          </foreignObject>
          <!--svg id="container" class="container" width="100%" height="100%" viewBox="0 0 1600 800" preserveAspectRatio="xMidYMid meet" style="position:absolute;top:0;left:0;width:100%;height:100%;background-color:green;">
              <rect x="0" y="0" width="100%" height="100%" fill="pink" opacity="0.5"></rect>
          </svg-->
        </svg>
      </div>
    </main>
  </body>
</html>
